---
title: "Index page"
author: "Kevin Rue"
date: "`r Sys.Date()`"
output: html_document
---

```{r libraries, include=FALSE}
library(tidyverse)
```

```{r snakemake, include=FALSE}
if (interactive()) {
  report_paths <- c(
    "reports/packages_r.html",
    file.path("reports/fishpond", list.files("../reports/fishpond/"))
  )
} else {
  report_paths <- snakemake@input
}
report_paths <- str_remove(report_paths, "reports/")
```

## Software environment

```{r, echo=FALSE, results='asis'}
path_all <- grep("packages_r.html", report_paths, value = TRUE)
cat(sprintf("- [R packages](%s)", path_all), sep = "\n")
```

## fishpond

The [fishpond](https://www.bioconductor.org/packages/release/bioc/html/fishpond.html) Bioconductor package was used to import the quantification files produced by [simpleaf](https://simpleaf.readthedocs.io/en/latest/) into R.

A joint report was produced to compare the results of all samples.

```{r, echo=FALSE, results='asis'}
path_all <- grep("fishpond.html", report_paths, value = TRUE)
cat(sprintf("- [Joint report](%s)", path_all), sep = "\n")
```

<details>
  <summary>Individual sample reports</summary>
```{r, echo=FALSE, results='asis'}
path_samples <- grep("fishpond/", report_paths, value = TRUE)
names(path_samples) <- fs::path_ext_remove(basename(path_samples))
cat(sprintf("- [%s](%s)", names(path_samples), path_samples), sep = "\n")
```
</details>

## barcodeRanks

The `barcodeRanks()` function of the [DropletUtils](https://bioconductor.org/packages/release/bioc/html/DropletUtils.html) Bioconductor package was used to dentify the knee and inflection points of the barcode rank curve for each sample.

This section reports on the results of this function, to confirm that reasonable values were obtained.

<details>
  <summary>Individual sample reports</summary>
```{r, echo=FALSE, results='asis'}
path_samples <- grep("barcodeRanks/", report_paths, value = TRUE)
names(path_samples) <- fs::path_ext_remove(basename(path_samples))
cat(sprintf("- [%s](%s)", names(path_samples), path_samples), sep = "\n")
```
</details>

## emptyDrops

The `emptyDrops()` function of the [DropletUtils](https://bioconductor.org/packages/release/bioc/html/DropletUtils.html) Bioconductor package was used to predict empty droplets for each sample.

This section reports on the results of this function, to guide the choice of an appropriate FDR threshold.

A joint report was produced to compare the results of all samples.

```{r, echo=FALSE, results='asis'}
path_all <- grep("emptyDrops.html", report_paths, value = TRUE)
cat(sprintf("- [Joint report](%s)", path_all), sep = "\n")
```

<details>
  <summary>Individual sample reports</summary>
```{r, echo=FALSE, results='asis'}
path_samples <- grep("emptyDrops/", report_paths, value = TRUE)
names(path_samples) <- fs::path_ext_remove(basename(path_samples))
cat(sprintf("- [%s](%s)", names(path_samples), path_samples), sep = "\n")
```
</details>

## After emptyDrops

This section describes the barcodes remaining after filtering out empty droplets, but before removing droplets with high mitochondrial content.

<details>
  <summary>Individual sample reports</summary>
```{r, echo=FALSE, results='asis'}
path_samples <- grep("after_emptyDrops/", report_paths, value = TRUE)
names(path_samples) <- fs::path_ext_remove(basename(path_samples))
cat(sprintf("- [%s](%s)", names(path_samples), path_samples), sep = "\n")
```
</details>

## Before scDblFinder

This section describes the barcodes remaining after removing droplets with high mitochondrial content, but before running scDblFinder.

In particular, `scDblFinder()` works best when clustering information is available, to produce artificial doublets made of cells from different clusters.
Consequently, these reports explore the parameter space of clustering algorithms to guide the decision of which clustering results to use as input for `scDblFinder()`.

<details>
  <summary>Individual sample reports</summary>
```{r, echo=FALSE, results='asis'}
path_samples <- grep("before_scdblfinder/", report_paths, value = TRUE)
names(path_samples) <- fs::path_ext_remove(basename(path_samples))
cat(sprintf("- [%s](%s)", names(path_samples), path_samples), sep = "\n")
```
</details>
